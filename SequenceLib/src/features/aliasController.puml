@startuml
/'Вспомогательная процедура отрисовки участников: формирует мапу имя:алиас'/

!unquoted procedure parties($partyType, $name="", $alias="", $order="")
%invoke_procedure("checkPartyInput", $partyType, $name, $alias, $order)
!endprocedure


!unquoted procedure checkPartyInput($partyType, $name="", $alias="", $order="")
    !if %not(%json_key_exists($defaultPartyTypes, $partyType))
        !$alias = $partyType
        !$partyType = ""
    !endif
    %invoke_procedure("findAlias", $partyType, $name, $alias, $order)
!endprocedure

!unquoted procedure findAlias($partyType="", $name="", $alias="", $order="")
    !$alias = %splitstr($alias, ",")
    !$searchResult = ""
    !$aliasArrayToCheck = []
    !$aliasToCheck = {}
    !foreach $item in $alias
        !if %json_key_exists($currentAliasMap,$item)
            !$searchResult = 1
        !else
            !if %json_key_exists($customAliasMap,$item)
                !$searchResult = 2
            !else
                !$searchResult = 0
            !endif
        !endif
        !$aliasToCheck = %json_set($aliasToCheck, "type", $partyType)
        !$aliasToCheck = %json_set($aliasToCheck, "name", $name)
    note across:$aliasToCheck = $searchResult
        !$aliasArrayToCheck = %json_add($aliasArrayToCheck, $item, $aliasToCheck)
    note across:$aliasArrayToCheck\n $searchResult
    !endfor

!endprocedure